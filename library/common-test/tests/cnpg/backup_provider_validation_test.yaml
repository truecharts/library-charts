suite: cnpg backup provider validation test
templates:
  - common.yaml
release:
  name: test-release-name
  namespace: test-release-namespace
tests:
  - it: should fail with accessKey missing with s3 provider
    set:
      credentials:
        test:
          type: s3
          secretKey: test
          url: some-url
          bucket: some-bucket
          encrKey: some-encr-key
      cnpg:
        my-pg:
          enabled: true
          backups:
            enabled: true
            credentials: test
            manualBackups:
              - name: today
    asserts:
      - failedTemplate:
          errorMessage: CNPG Backup - Expected [backups.s3.accessKey] to be defined and non-empty when provider is set to [s3]

  - it: should fail with secretKey missing with s3 provider
    set:
      credentials:
        test:
          type: s3
          accessKey: test
          url: some-url
          bucket: some-bucket
          encrKey: some-encr-key
      cnpg:
        my-pg:
          enabled: true
          backups:
            enabled: true
            credentials: test
            manualBackups:
              - name: today
    asserts:
      - failedTemplate:
          errorMessage: CNPG Backup - Expected [backups.s3.secretKey] to be defined and non-empty when provider is set to [s3]
